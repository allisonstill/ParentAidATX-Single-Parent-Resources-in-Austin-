stages:
  - build
  - test
  - deploy

install_and_build:
  stage: build
  image: node:latest
  script:
    - cd ./frontend && npm install
    - npm run build
  rules:
    - if: '$CI_COMMIT_REF_NAME == "main"'
      when: always

unit-test-job:
  stage: test
  image: node:latest
  script:
    - echo "Running Jest tests..."
    - cd frontend # Navigate to the front-end directory
    - npm install # Install dependencies
    - npm test # Run Jest tests
    - echo "Jest tests complete."

selenium-test-job:
  stage: test
  image: python:3.8
  services:
    - name: selenium/standalone-chrome:latest
      alias: selenium
  script:
    - echo "Running Selenium tests..."
    - pip install selenium webdriver-manager
    - python -m unittest discover -s frontend/__tests__ -p "acceptance-tests.py" -v
    - echo "Selenium tests complete."

deploy_to_amplify:
  stage: deploy
  image: node:latest
  dependencies:
    - run_tests
  script:
    - echo "Deploying to Amplify"
  rules:
    - if: '$CI_COMMIT_REF_NAME == "main"'
      when: always
